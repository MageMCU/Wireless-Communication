## Radio - XBee-PRO 900HP - 900 MHz RF Module
- Digi International - XBee-PRO 900HP (S3B) DigiMesh, 900MHz, 250mW, Wire Antenna, 200Kbps (North America XBP9B-DMWT-002). The Digi XBee-PRO 900HP DigiMesh Kit (US/Canada XKB9-DMT-UHP) comes with three radios.
    - Recommended Digi User Guides
        - Digi XBee-PRO 900HP DigiMesh Kit - Radio Frequency (RF) Module - User Guide
            - Supplemental: Digi - XBee-PRO 900HP/XSC RF Modules - S3and S3B - User Guide (This guide has more information.)
        - Digi - XCTU - Configuration and Test Utility Software
        - Digi - XBee Grove Development Board - User Guide
- Digi XCTU - Configuration and Test Utility Software.
    - Radio module operating mode
        - AT operating mode
        - API operating mode (SPI communication requires this operating mode.)
        - API escaped operating mode
- Addional Information - Arduino Uno
    - Digi - [Do more with API mode: XBee libraries](https://docs.digi.com//resources/documentation/digidocs/90001496/concepts/c_xbee_libraries_api_mode.htm?TocPath=XBee%20API%20mode%7C_____6)
        -  While using the Arduino SPI.h library is possible for low-level communication, there is no official or widely-supported Arduino library specifically for the XBee 900HP (S3/S3B) using SPI. The popular xbee-arduino library only supports API mode over a UART (serial) connection, not SPI. 
            - Sent support request to Digi on this issue otherwise there seems to be a lot of develpment ahead...

## Experimental Approach (For author's purposes ONLY - DO NOT TRY)
- Using an Arduino Uno with an XBee 900HP in **SPI mode** similarly with the radio nRF24L01+ requires three primary steps: hardware connection, configuring the XBee for SPI and API modes, and writing the Arduino code. (*The Raspberry Pi 3 will be tested once the Arduino Uno test is completed.*) Since the Arduino Uno uses 5V logic and the XBee 900HP uses 3.3V logic, its important a **logic level shifter** is used for safety.
- **(1) Hardware connection**

| Arduino Uno  (Master) | Logic Level Shifter | XBee 900HP (Slave) | Connection Detail                 |
| ---- | ---- | ---- | ---- |
| **SS** (Pin 10) | Low Voltage (LV) | **SPI_nSSel** (Pin 17) | **Chip select line** for controlling the XBee. |
| **MOSI** (Pin 11) | LV | **SPI_MOSI** (Pin 11) | **Master-Out Slave-In** for transmitting data. |
| **MISO** (Pin 12) | High Voltage (HV) | **SPI_MISO** (Pin 4) | **Master-In Slave-Out** for receiving data. |
| **SCK** (Pin 13) | LV | **SPI_Clk** (Pin 18) | SPI Clock generated by Arduino. |
| **GND** | GND | **GND** | Common Ground Connection |
| **5V** | HV | - | Powers the high-voltage side of the shifter. |
| - | LV | **VCC** (Pin 1) | The 3.3V supply for the XBee. |
| - | LV | **SPI_nATTN** (Pin 19) | An optional pin for the XBee to alert the Arduino that data is ready. |

- **(2) Configure the XBee**
    - The **Digi XCTU software** is used to change the XBee settings from the default UART mode to SPI and API mode. This requires connecting the XBee to the computer using a USB connection. (*The Digi Xbee-PRO 900HP DigiMesh Kit comes with development boards which has this USB cababilties.*)
    1. **Read your current settings:** Open XCTU and select the XBee.
    2. **Enable SPI:** Go to the I/O Settings section and configure the following pins:
        * **P1(SPI_nATTN):** Set to 3 (SPI_nATTN)
        * **P2(SPI_MISO):** Set to 4 (SPI_MISO)
        * **P3(SPI_MOSI):** Set to 3 (SPI_MOSI)
        * **P4(SPI_CLK):** Set to 2 (SPI_CLK)
        * **P8(SPI_nSSel):** Set to 1 (SPI_nSSel)
    3. **Enable API mode:** Serial port flow control is not possible when using the SPI port. The SPI only operates in API mode 1. The SPI does not support Transparent mode or API mode 2 (with escaped characters). This means that the AP configuration only applies to the UART interface and is ignored while using the SPI. (source: *Digi XBeeÂ®-PRO 900HP/XSC RF Modules - User Guide*)
S3 and S3B)
    4. **Save settings:** Write the changes to the module.
- **(3) Arduino Uno sketch**
    - Use the Arduino SPI library to set up the Uno as the master and send and receive API frames to and from the XBee. The following is a basci structure for communication. (source: *Google AI*) The code is a work in progress.
```c++
// CODE HAS YET TO BE TESTED - CHECK SYNTAX

#include <SPI.h>
// Define Xbee SPI pins fro Arduino Uno
const int XBEE_SS_PIN = 10;
const int XBEE_nATTN_PIN = 9;

void setup() {
    Serial.begins(9600);
    SPI.begin();
    // Set the Slave Select (SS) pin as an output and set it high
    // to deselect the XBee initially.
    pinMode(XBEE_SS_PIN, OUTPUT);
    digitalWrite(XBEE_SS_PIN, HIGH);

    // Configure the SPI settings for the XBee 900HP
    // The XBee uses uses SPI mode 0 (CPOL=0, CPHA=0) and MSB first.
    SPI.beginTransaction(SPISettings(5000000, MSFIRST, SPI_MODE0));

    // Optional: Listen for the ATTN pin for incoming data
    pinMode(XBEE_nATTN_PIN, INPUT);
}

void loop() {
    // Example: Send an API frame
    if (Serial.available()) {
        char receivedChar = Serial.read();
        if (receivedChar == 's' {
            sendXBeeApiFrame();
        }
    }

    // Example: Check for incoming data from XBee
    if (digitalRead(XBEE_nATTN_PIN) == LOW) {
        readXBeeApiFrame();
    }
}

void sendXBeeApiFrame() {
    // Example API frame payload (e.g. AT command frame)
    byte frame[] = {0x7E, 0x00, 0x04, 0x08, 0x01, 0x4E, 0x49, 0x6E);

    // Selcet the XBee
    digitalWrite(XBEE_SS_PIN, LOW);

    for (int i = 0; i < sizeof(frame); i++) {
        SPI.transfer(frame[i]);
    }

    // Deselect the XBee
    digitalWrite(XBEE_SS_PIN, HIGH);

    Serial.println("API frame sent");
}

void readXBeeApiFrame() {
    // Read incoming data when the attention pin is low
    // Select the XBee
    digitalWrite(XBEE_SS_PIN, LOW);

    // The XBee documentation is key to correctly interpreting the API frame...
    // The frame begins with the start delimiter (0x7E) and has the length feild...
    // The SPI.transfer() function perfoems a simultaneous reand and write.
    bytr receivedByte = SPI.transfer(0xFF);

    // Read the rest of the fram based on the length field
    // ...

    // Deselect the XBee
    digitalWrite(XBEE_SS_PIN, HIGH);
}

// Working on ther versions that are similar to this code...
```
- The key consideration are (1) the Logic Level Shifter, (2) the API Frame format, (3) the SPI_nATTN Pin and (4) Dedicated SPI Libtrary.
    - The standard Arduino SPI.h library is functional but using a specialized XBee library (such as the one from Digi) can significantly simplify the process of constructing and parsing API frames.

### ***include folder***

### ***src folder***

### ***root folder***

### Notes
- Under review and testing

### How to use this repository
- Open PlatformIO with a new project...
- Copy and Paste contents from here into your project...
- Install RadioHead Lib from PlatformIO.
    - Understand how to use the platformio.ini file with multiple src folders - see file for details.
